<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Docker-gitlab-ci-runner by sameersbn</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/sameersbn/docker-gitlab-ci-runner">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-gitlab-ci-runner/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-gitlab-ci-runner/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Docker-gitlab-ci-runner</h1>
          <p>Dockerfile to build a base GitLab CI Runner container image.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/sameersbn">sameersbn</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li>
<a href="#introduction">Introduction</a>

<ul>
<li><a href="#version">Version</a></li>
<li><a href="Changelog.md">Changelog</a></li>
</ul>
</li>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li>
<a href="#configuration">Configuration</a>

<ul>
<li><a href="#data-store">Data Store</a></li>
</ul>
</li>
<li>
<a href="#maintenance">Maintenance</a>

<ul>
<li><a href="#ssh-login">SSH Login</a></li>
</ul>
</li>
<li><a href="#upgrading">Upgrading</a></li>
<li><a href="#references">References</a></li>
</ul><h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>Dockerfile to build a GitLab CI Runner container image.</p>

<h2>
<a name="version" class="anchor" href="#version"><span class="octicon octicon-link"></span></a>Version</h2>

<p>Current Version: 4.0.0</p>

<h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Pull the latest version of the image from the docker index. This is the recommended method of installation as it is easier to update image in the future. These builds are performed by the <strong>Docker Trusted Build</strong> service.</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab-ci-runner
</pre></div>

<p>Starting from GitLab CI Runner version 4.0.0, You can pull a particular version of GitLab CI Runner by specifying the version number. For example,</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab-ci-runner:4.0.0
</pre></div>

<p>Alternately you can build the image yourself.</p>

<div class="highlight highlight-bash"><pre>git clone https://github.com/sameersbn/docker-gitlab-ci-runner.git
<span class="nb">cd </span>docker-gitlab-ci-runner
docker build -t<span class="o">=</span><span class="s2">"$USER/gitlab-ci-runner"</span> .
</pre></div>

<h1>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick Start</h1>

<p>Before you can start the GitLab CI Runner image you need to make sure you have a <a href="https://www.gitlab.com/gitlab-ci/">GitLab CI</a> server running. Checkout the <a href="https://github.com/sameersbn/docker-gitlab-ci">docker-gitlab-ci</a> project for getting a GitLab CI server up and running.</p>

<p>Before the image can be started, the runner should be registered on the GitLab CI server. This can be done by running the image with the <strong>app:setup</strong> command.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab-ci-runner -i -t <span class="se">\</span>
  sameersbn/gitlab-ci-runner app:setup
</pre></div>

<p>The command will prompt you to specify the location of the GitLab CI server and provide the registration token to access the server. After configuring the runner, the image can now be started.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab-ci-runner -d sameersbn/gitlab-ci-runner
</pre></div>

<p>You should now have GitLab CI Runner up and running. Please read <a href="#data-store">Data Store</a> section for deployment in production environments.</p>

<h1>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h1>

<h2>
<a name="data-store" class="anchor" href="#data-store"><span class="octicon octicon-link"></span></a>Data Store</h2>

<p>GitLab CI Runner saves the configuration for connection and access to the GitLab CI server. In addition, SSH keys are generated as well. To make sure this configuration is not lost when when the container is stopped/deleted, we should mount a data store volume at</p>

<ul>
<li>/home/gitlab_ci_runner/data</li>
</ul><p>Volumes can be mounted in docker by specifying the <strong>'-v'</strong> option in the docker run command.</p>

<div class="highlight highlight-bash"><pre>mkdir /opt/gitlab-ci-runner/data
docker run -name gitlab-ci-runner -d -h gitlab-ci-runner.local.host <span class="se">\</span>
  -v /opt/gitlab-ci-runner/data:/home/gitlab_ci_runner/data <span class="se">\</span>
  sameersbn/gitlab-ci-runner
</pre></div>

<h1>
<a name="maintenance" class="anchor" href="#maintenance"><span class="octicon octicon-link"></span></a>Maintenance</h1>

<h2>
<a name="ssh-login" class="anchor" href="#ssh-login"><span class="octicon octicon-link"></span></a>SSH Login</h2>

<p>There are two methods to gain root login to the container, the first method is to add your public rsa key to the authorized_keys file and build the image.</p>

<p>The second method is use the dynamically generated password. Every time the container is started a random password is generated using the pwgen tool and assigned to the root user. This password can be fetched from the docker logs.</p>

<div class="highlight highlight-bash"><pre>docker logs gitlab-ci 2&gt;<span class="p">&amp;</span>1 <span class="p">|</span> grep <span class="s1">'^User: '</span> <span class="p">|</span> tail -n1
</pre></div>

<p>This password is not persistent and changes every time the image is executed.</p>

<h2>
<a name="upgrading" class="anchor" href="#upgrading"><span class="octicon octicon-link"></span></a>Upgrading</h2>

<p>To upgrade to newer GitLab CI Runner releases, simply follow this 4 step upgrade procedure.</p>

<ul>
<li>
<strong>Step 1</strong>: Stop the currently running image</li>
</ul><div class="highlight highlight-bash"><pre>docker stop gitlab-ci-runner
</pre></div>

<ul>
<li>
<strong>Step 2</strong>: Update the docker image.</li>
</ul><div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab-ci-runner
</pre></div>

<ul>
<li>
<strong>Step 4</strong>: Start the image</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name gitlab-ci-runner -d <span class="o">[</span>OPTIONS<span class="o">]</span> sameersbn/gitlab-ci-runner
</pre></div>

<h2>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab-ci-runner/blob/master/README.md">https://gitlab.com/gitlab-org/gitlab-ci-runner/blob/master/README.md</a></li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>