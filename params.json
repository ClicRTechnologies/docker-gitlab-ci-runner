{"name":"Docker-gitlab-ci-runner","tagline":"Dockerfile to build a base GitLab CI Runner container image.","body":"# Table of Contents\r\n- [Introduction](#introduction)\r\n    - [Version](#version)\r\n    - [Changelog](Changelog.md)\r\n- [Installation](#installation)\r\n- [Quick Start](#quick-start)\r\n- [Configuration](#configuration)\r\n    - [Data Store](#data-store)\r\n- [Maintenance](#maintenance)\r\n    - [SSH Login](#ssh-login)\r\n- [Upgrading](#upgrading)\r\n- [References](#references)\r\n\r\n# Introduction\r\nDockerfile to build a GitLab CI Runner container image.\r\n\r\n## Version\r\nCurrent Version: 4.0.0\r\n\r\n# Installation\r\n\r\nPull the latest version of the image from the docker index. This is the recommended method of installation as it is easier to update image in the future. These builds are performed by the **Docker Trusted Build** service.\r\n\r\n```bash\r\ndocker pull sameersbn/gitlab-ci-runner\r\n```\r\n\r\nStarting from GitLab CI Runner version 4.0.0, You can pull a particular version of GitLab CI Runner by specifying the version number. For example,\r\n\r\n```bash\r\ndocker pull sameersbn/gitlab-ci-runner:4.0.0\r\n```\r\n\r\nAlternately you can build the image yourself.\r\n\r\n```bash\r\ngit clone https://github.com/sameersbn/docker-gitlab-ci-runner.git\r\ncd docker-gitlab-ci-runner\r\ndocker build -t=\"$USER/gitlab-ci-runner\" .\r\n```\r\n\r\n# Quick Start\r\nBefore you can start the GitLab CI Runner image you need to make sure you have a [GitLab CI](https://www.gitlab.com/gitlab-ci/) server running. Checkout the [docker-gitlab-ci](https://github.com/sameersbn/docker-gitlab-ci) project for getting a GitLab CI server up and running.\r\n\r\nBefore the image can be started, the runner should be registered on the GitLab CI server. This can be done by running the image with the **app:setup** command.\r\n\r\n```bash\r\ndocker run -name gitlab-ci-runner -i -t \\\r\n  sameersbn/gitlab-ci-runner app:setup\r\n```\r\n\r\nThe command will prompt you to specify the location of the GitLab CI server and provide the registration token to access the server. After configuring the runner, the image can now be started.\r\n\r\n```bash\r\ndocker run -name gitlab-ci-runner -d sameersbn/gitlab-ci-runner\r\n```\r\n\r\nYou should now have GitLab CI Runner up and running. Please read [Data Store](#data-store) section for deployment in production environments.\r\n\r\n# Configuration\r\n\r\n## Data Store\r\nGitLab CI Runner saves the configuration for connection and access to the GitLab CI server. In addition, SSH keys are generated as well. To make sure this configuration is not lost when when the container is stopped/deleted, we should mount a data store volume at\r\n\r\n* /home/gitlab_ci_runner/data\r\n\r\nVolumes can be mounted in docker by specifying the **'-v'** option in the docker run command.\r\n\r\n```bash\r\nmkdir /opt/gitlab-ci-runner/data\r\ndocker run -name gitlab-ci-runner -d -h gitlab-ci-runner.local.host \\\r\n  -v /opt/gitlab-ci-runner/data:/home/gitlab_ci_runner/data \\\r\n  sameersbn/gitlab-ci-runner\r\n```\r\n\r\n# Maintenance\r\n\r\n## SSH Login\r\nThere are two methods to gain root login to the container, the first method is to add your public rsa key to the authorized_keys file and build the image.\r\n\r\nThe second method is use the dynamically generated password. Every time the container is started a random password is generated using the pwgen tool and assigned to the root user. This password can be fetched from the docker logs.\r\n\r\n```bash\r\ndocker logs gitlab-ci 2>&1 | grep '^User: ' | tail -n1\r\n```\r\n\r\nThis password is not persistent and changes every time the image is executed.\r\n\r\n## Upgrading\r\n\r\nTo upgrade to newer GitLab CI Runner releases, simply follow this 4 step upgrade procedure.\r\n\r\n- **Step 1**: Stop the currently running image\r\n\r\n```bash\r\ndocker stop gitlab-ci-runner\r\n```\r\n\r\n- **Step 2**: Update the docker image.\r\n\r\n```bash\r\ndocker pull sameersbn/gitlab-ci-runner\r\n```\r\n\r\n- **Step 4**: Start the image\r\n\r\n```bash\r\ndocker run -name gitlab-ci-runner -d [OPTIONS] sameersbn/gitlab-ci-runner\r\n```\r\n\r\n\r\n## References\r\n  * https://gitlab.com/gitlab-org/gitlab-ci-runner/blob/master/README.md\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}